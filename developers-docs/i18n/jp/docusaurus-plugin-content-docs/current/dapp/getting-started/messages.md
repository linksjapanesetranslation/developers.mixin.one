---
title: メッセージの送受信
sidebar_position: 6
---

## メッセージの送信

メッセージ送信機能を使って、お知らせの送信やユーザーへの返信などの機能を実装することができます。メッセージを送信する前に、メッセージ構造を作成する必要があります。

Mixin Messengerは[各種メッセージタイプ](/docs/api/messages/category)をサポートします。プレーンテキストのメッセージは以下のような構造になっています：

```json
{
  "id":                 "an UUID",
  "action":             "CREATE_MESSAGE",
  "params": {
    "conversation_id":  "an UUID",
    "category":         "PLAIN_TEXT",
    "status":           "SENT",
    "message_id":       "an UUID",
    "data":             "Base64 encoded data" ,
  }
}
```

::ヒント
アプリケーションはメッセージを送信するために、ユーザーの「user_id」を知る必要があります。

「user_id」は、ユーザーがアプリケーションにメッセージを送る、ボットを友人として追加する、アプリケーションを承認する、の3つの方法で取得することができます。
:::

ここでは、Golangの公式SDKを使ってプレーンテキストメッセージを送信する例を示します。

```go
// @TODO an example.
```

:::インフォ
メッセージを送信する前に、会話が作成されていることを確認する必要があります。ユーザーからメッセージを送るか、現在のボットを友達として追加している場合は、会話を作成する必要はありません。しかし、そうでない場合は、[会話を作成](/docs/api/conversations/create) APIを呼び出して、会話が作成されたことを確認する必要があります。
:::

## メッセージの受信

```go
// @TODO an example.
```


::インフォ
1. ユーザーが現在のボットを友達として追加すると、システムが自動的にボットに「こんにちは」メッセージを送信します。
2. ユーザーのメッセージは7日間だけサーバーに保存され、期限切れのメッセージは開発者が何もしなければ破棄されます。
3. Websocketで送信されたメッセージはgzipで圧縮される必要があり、受信したメッセージはそれに応じて解凍さます。
4. Websocketでは自動再接続を強く推奨します。401の場合、WebSocketの接続を停止する必要があります。なお、5分以上経過すると401エラーが発生します。
5. ボットのメッセージクォータは、1分あたり100,000メッセージです。
:::
